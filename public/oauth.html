<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login ...</title>
</head>
<body>
    Waiting ...
    <script>
        const url = window.location.href
        const code = getParameterByName('code', url)
        
        if (code) {
            fetch(
                `https://react-ghpages-blog-oauth.herokuapp.com/authenticate/${code}`,
                {
                    method: 'GET'
                }
            )
            .then(response => {
                if (response.ok) return response
                debugger
                alert('Failed')
            })
            .then(response => response.json())
            .then(result => {
                const token = result.token
                if (token) {
                    window.localStorage.setItem('access_token', token)
                } else alert('Error')
                window.close()
            })
        }

        function getParameterByName(name, url) {
            if (!url) url = window.location.href
            name = name.replace(/[[\]]/g, '\\$&')
            const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)')
            const results = regex.exec(url)

            if (!results) return null
            if (!results[2]) return ''
            return decodeURIComponent(results[2].replace(/\+/g, ' '))
        }
    </script>
</body>
</html>